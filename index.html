<!DOCTYPE html>
<html lang="gl">
<head>
    <meta charset="UTF-8">
    <title>Calculadora Nómina Vicusgraf</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
    /* ---------- ESTILO XERAL ---------- */
    body {
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Arial, sans-serif;
        background: #f3f8f4;
        color: #1f3b2c;
    }

    #wizard {
        position: relative;
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
        overflow: hidden;
        height: 100vh;
        background: #ffffff;
        box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }

    .screen {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        height: calc(100vh - 20px);
        padding: 20px;
        box-sizing: border-box;
        overflow-y: auto;
        background: #ffffff;
        transition: top 0.4s ease;
    }

    .screen.active {
        top: 0;
    }

    .screen.up {
        top: -100%;
    }

    h2 {
        margin-top: 0;
        font-size: 1.6rem;
        color: #1f3b2c;
    }

    h3 {
        margin-top: 25px;
        font-size: 1.2rem;
        color: #2d5c42;
    }

    label {
        display: block;
        margin-top: 15px;
        font-weight: 600;
    }

    input[type="number"],
    input[type="date"],
    select {
        width: 100%;
        padding: 12px;
        margin-top: 5px;
        border-radius: 10px;
        border: 1px solid #b7d2c0;
        background: #f7fbf8;
        font-size: 1rem;
        box-sizing: border-box;
    }

    input[type="checkbox"],
    input[type="radio"] {
        transform: scale(1.2);
        margin-right: 8px;
    }

    button {
        width: 100%;
        padding: 14px;
        margin-top: 25px;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
    }

    .next {
        background: #4caf50;
        color: white;
    }

    .back {
        background: #d9e8dd;
        color: #1f3b2c;
    }

    .finish {
        background: #2e7d32;
        color: white;
    }

    #resumoDevengos,
    #resumoBases,
    #resumoDeduccions,
    #resumoLiquido {
        background: #f3f8f4;
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
        border: 1px solid #cfe3d6;
    }

    #glosario {
        background: #f3f8f4;
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #cfe3d6;
    }

    p.info {
        font-size: 0.9rem;
        color: #486854;
        margin-top: 5px;
    }
    </style>
</head>

<body>

<div id="wizard">

    <!-- PANTALLA 1 — DATOS XERAIS -->
    <section class="screen active" id="screen-1">
        <h2>Datos xerais da nómina</h2>

        <label>Mes da nómina</label>
        <select id="mes"></select>

        <label>Ano da nómina</label>
        <select id="ano"></select>

        <label>Nivel salarial</label>
        <select id="nivel"></select>

        <label>Data de ingreso na empresa</label>
        <input type="date" id="dataIngreso">

        <label>% IRPF aplicado</label>
        <input type="number" id="irpf" step="0.1">

        <label>
            <input type="checkbox" id="prorrata"> Pagas extra prorrateadas
        </label>

        <button class="next" data-next="2">Continuar</button>
    </section>


    <!-- PANTALLA 2 — INCIDENCIAS -->
    <section class="screen" id="screen-2">
        <h2>Incidencias do mes</h2>

        <h3>Nocturnidade</h3>
        <label><input type="checkbox" id="noiteCompleta"> Mes completo en noite</label>
        <label>Días completos nocturnos</label>
        <input type="number" id="diasNoite">
        <label>Horas nocturnas laborables</label>
        <input type="number" id="horasNoiteLab">
        <label>Horas nocturnas festivas</label>
        <input type="number" id="horasNoiteFest">

        <h3>Horas extra</h3>
        <label>Horas extra laborables</label>
        <input type="number" id="hexLab">
        <label>Horas extra festivas</label>
        <input type="number" id="hexFest">
        <label>Categoría horas extra</label>
        <select id="categoriaHex">
            <option value="">Selecciona</option>
            <option value="normal">Normal</option>
            <option value="especial">Especial</option>
        </select>
        <label><input type="checkbox" id="hexNocturnas"> Horas extra nocturnas</label>

        <h3>Incapacidade Temporal</h3>
        <label><input type="checkbox" id="haiIT"> Hai baixa por IT este mes</label>
        <p class="info">Se marcas esta opción, pedirémosche os datos da baixa na seguinte pantalla.</p>

        <button class="back" data-back="1">Volver</button>
        <button class="next" data-next="3">Continuar</button>
    </section>


    <!-- PANTALLA 3 — IT -->
    <section class="screen" id="screen-3">
        <h2>Incapacidade Temporal (IT)</h2>

        <h3>Tipo de baixa</h3>
        <label><input type="radio" name="tipoIT" value="ec"> Enfermidade común</label>
        <p class="info">Baixa por enfermidade non relacionada co traballo.</p>

        <label><input type="radio" name="tipoIT" value="anl"> Accidente non laboral</label>
        <p class="info">Lesión producida fóra do traballo e non recoñecida como profesional.</p>

        <label><input type="radio" name="tipoIT" value="atep"> AT/EP – Accidente de Traballo / Enfermidade Profesional</label>
        <p class="info">Lesión ou enfermidade causada polo traballo ou no traxecto ao traballo (in itinere). Prestación SS: 75% da BRD desde o día seguinte.</p>

        <label><input type="checkbox" id="hospitalizacion"> Hospitalización</label>
        <p class="info">Se estiveches ingresado, o convenio pode mellorar a prestación ata o 100%.</p>

        <h3>Tramo no que te atopas (días de baixa)</h3>
        <p class="info">Os tramos refírense ao número total de días que levas de baixa, non só aos deste mes.</p>
        <select id="tramoIT">
            <option value="">Selecciona un tramo</option>
            <option value="1-3">1–3 días de baixa (0%)</option>
            <option value="4-20">4–20 días de baixa (60%)</option>
            <option value="21+">21+ días de baixa (75%)</option>
            <option value="atep">AT/EP (75%)</option>
        </select>

        <h3>Base de cotización do mes anterior</h3>
        <input type="number" id="baseAnterior" step="0.01">
        <p class="info">Introduce a base de cotización por continxencias comúns da nómina do mes anterior á baixa.</p>
        <p id="brdMostrada">Base reguladora diaria calculada: —</p>

        <h3>Días de baixa neste mes</h3>
        <input type="number" id="diasMesIT">
        <p class="info">Só se usa para calcular o importe deste mes. Non afecta ao tramo.</p>

        <button class="back" data-back="2">Volver</button>
        <button class="next" data-next="4">Continuar</button>
    </section>


    <!-- PANTALLA 4 — RESUMO -->
    <section class="screen" id="screen-4">
        <h2>Resumo da nómina</h2>

        <div id="resumoDevengos"></div>
        <div id="resumoBases"></div>
        <div id="resumoDeduccions"></div>
        <div id="resumoLiquido"></div>

        <button class="back" data-back="3">Volver</button>
        <button class="finish">Finalizar</button>
    </section>


    <!-- PANTALLA 5 — GLOSARIO (aquí só deixo o contedor, poderemos enchelo con máis detalle despois) -->
    <section class="screen" id="screen-5">
        <h2>Glosario de termos</h2>
        <div id="glosario">
            <p><strong>Nivel salarial:</strong> categoría retributiva segundo o convenio.</p>
            <p><strong>Base de cotización:</strong> importe sobre o que se calculan as cotas á Seguridade Social.</p>
            <p><strong>Continxencias comúns:</strong> situacións de enfermidade común ou accidente non laboral.</p>
            <p><strong>AT/EP:</strong> Accidente de Traballo / Enfermidade Profesional.</p>
            <p><strong>Base reguladora diaria (BRD):</strong> base de cotización do mes anterior dividida entre 30.</p>
            <p><strong>Devengos:</strong> todos os importes que suman ao salario bruto.</p>
            <p><strong>Deduccións:</strong> cotas á Seguridade Social, desemprego, formación e IRPF.</p>
            <p><strong>Líquido a percibir:</strong> importe final que se cobra en conta.</p>
        </div>
        <button class="back" data-back="4">Pechar</button>
    </section>

</div>

<script>
/* ---------- INICIALIZACIÓN BÁSICA ---------- */

const screens = document.querySelectorAll('.screen');

function showScreen(id) {
    screens.forEach(s => {
        s.classList.remove('active', 'up');
    });
    const target = document.getElementById('screen-' + id);
    target.classList.add('active');
}

/* Meses e anos */
(function initMesAnoNivel() {
    const mesSelect = document.getElementById('mes');
    const anoSelect = document.getElementById('ano');
    const nivelSelect = document.getElementById('nivel');

    const meses = [
        'Xaneiro','Febreiro','Marzo','Abril','Maio','Xuño',
        'Xullo','Agosto','Setembro','Outubro','Novembro','Decembro'
    ];
    meses.forEach((m, i) => {
        const opt = document.createElement('option');
        opt.value = i + 1;
        opt.textContent = m;
        mesSelect.appendChild(opt);
    });

    const anoActual = new Date().getFullYear();
    for (let a = anoActual - 2; a <= anoActual + 1; a++) {
        const opt = document.createElement('option');
        opt.value = a;
        opt.textContent = a;
        anoSelect.appendChild(opt);
    }

    for (let n = 1; n <= 19; n++) {
        const opt = document.createElement('option');
        opt.value = n;
        opt.textContent = 'Nivel ' + n;
        nivelSelect.appendChild(opt);
    }
})();

/* ---------- NAVEGACIÓN ---------- */

document.querySelectorAll('.next').forEach(btn => {
    btn.addEventListener('click', () => {
        const nextId = btn.getAttribute('data-next');

        // Se pasa da pantalla 2 á 3 e non hai IT, saltamos directamente á 4
        if (nextId === '3') {
            const haiIT = document.getElementById('haiIT').checked;
            if (!haiIT) {
                showScreen('4');
                calcularResumo();
                return;
            }
        }

        if (nextId === '4') {
            // Antes de ir ao resumo, calculamos
            calcularResumo();
        }

        showScreen(nextId);
    });
});

document.querySelectorAll('.back').forEach(btn => {
    btn.addEventListener('click', () => {
        const backId = btn.getAttribute('data-back');
        showScreen(backId);
    });
});

/* ---------- CÁLCULO BRD A PARTIR DA BASE ANTERIOR ---------- */

const baseAnteriorInput = document.getElementById('baseAnterior');
const brdMostrada = document.getElementById('brdMostrada');
let brdCalculada = 0;

baseAnteriorInput.addEventListener('input', () => {
    const base = parseFloat(baseAnteriorInput.value || '0');
    if (base > 0) {
        brdCalculada = base / 30;
        brdMostrada.textContent = 'Base reguladora diaria calculada: ' + brdCalculada.toFixed(4) + ' €/día';
    } else {
        brdCalculada = 0;
        brdMostrada.textContent = 'Base reguladora diaria calculada: —';
    }
});

/* ---------- CÁLCULO IT POR TRAMOS ---------- */

function calcularIT() {
    const haiIT = document.getElementById('haiIT').checked;
    if (!haiIT) {
        return {
            devengoIT: 0,
            prestacionSS: 0,
            complementoEmpresa: 0
        };
    }

    const tipoIT = document.querySelector('input[name="tipoIT"]:checked');
    const tramo = document.getElementById('tramoIT').value;
    const diasMesIT = parseFloat(document.getElementById('diasMesIT').value || '0');

    if (!tipoIT || !tramo || brdCalculada === 0 || diasMesIT === 0) {
        return {
            devengoIT: 0,
            prestacionSS: 0,
            complementoEmpresa: 0
        };
    }

    let porcentaxeSS = 0;
    let porcentaxeFinal = 0;

    if (tramo === '1-3') {
        porcentaxeSS = 0;
        porcentaxeFinal = 0; // non complementamos enfermidade común
    } else if (tramo === '4-20') {
        porcentaxeSS = 0.60;
        porcentaxeFinal = 0.60;
    } else if (tramo === '21+') {
        porcentaxeSS = 0.75;
        porcentaxeFinal = 0.75;
    } else if (tramo === 'atep') {
        porcentaxeSS = 0.75;
        porcentaxeFinal = 0.75;
        const hosp = document.getElementById('hospitalizacion').checked;
        if (hosp) {
            porcentaxeFinal = 1.0; // se o convenio mellora ata 100% en hospitalización
        }
    }

    const prestacionSS = brdCalculada * diasMesIT * porcentaxeSS;
    const devengoFinal = brdCalculada * diasMesIT * porcentaxeFinal;
    const complementoEmpresa = devengoFinal - prestacionSS;

    return {
        devengoIT: devengoFinal,
        prestacionSS: prestacionSS,
        complementoEmpresa: complementoEmpresa > 0 ? complementoEmpresa : 0
    };
}

/* ---------- CÁLCULO RESUMO (VERSIÓN SIMPLE, CENTRADA EN IT) ---------- */

function calcularResumo() {
    const resumoDevengos = document.getElementById('resumoDevengos');
    const resumoBases = document.getElementById('resumoBases');
    const resumoDeduccions = document.getElementById('resumoDeduccions');
    const resumoLiquido = document.getElementById('resumoLiquido');

    // Aquí, de momento, imos centrarnos en IT e deixar o resto como esqueleto.
    const it = calcularIT();

    // Devengos (por agora só IT; máis adiante poderemos sumar salario base, nocturnidade, etc.)
    const totalDevengos = it.devengoIT;

    // Bases: simplificamos asumindo que todo o devengo IT cotiza como CC e AT/EP
    const baseCC = totalDevengos;
    const baseATEP = totalDevengos;
    const baseIRPF = totalDevengos;

    // Deduccións
    const tipoIRPF = parseFloat(document.getElementById('irpf').value || '0') / 100;
    const ccTraballador = baseCC * 0.047;
    const desemprego = baseATEP * 0.0155;
    const formacion = baseATEP * 0.001;
    const irpfImporte = baseIRPF * tipoIRPF;

    const totalDeduccions = ccTraballador + desemprego + formacion + irpfImporte;

    const liquido = totalDevengos - totalDeduccions;

    resumoDevengos.innerHTML = `
        <h3>Devengos</h3>
        <p>Prestación IT total: ${it.devengoIT.toFixed(2)} €</p>
        <p>Prestación SS incluída nese importe: ${it.prestacionSS.toFixed(2)} €</p>
        <p>Complemento empresa (se procede): ${it.complementoEmpresa.toFixed(2)} €</p>
        <p><strong>Total devengos: ${totalDevengos.toFixed(2)} €</strong></p>
    `;

    resumoBases.innerHTML = `
        <h3>Bases de cotización</h3>
        <p>Base CC: ${baseCC.toFixed(2)} €</p>
        <p>Base AT/EP: ${baseATEP.toFixed(2)} €</p>
        <p>Base IRPF: ${baseIRPF.toFixed(2)} €</p>
    `;

    resumoDeduccions.innerHTML = `
        <h3>Deduccións</h3>
        <p>Continxencias comúns (4,70%): ${ccTraballador.toFixed(2)} €</p>
        <p>Desemprego (1,55%): ${desemprego.toFixed(2)} €</p>
        <p>Formación profesional (0,10%): ${formacion.toFixed(2)} €</p>
        <p>IRPF (${(tipoIRPF*100).toFixed(1)}%): ${irpfImporte.toFixed(2)} €</p>
        <p><strong>Total deduccións: ${totalDeduccions.toFixed(2)} €</strong></p>
    `;

    resumoLiquido.innerHTML = `
        <h3>Líquido a percibir</h3>
        <p><strong>${liquido.toFixed(2)} €</strong></p>
    `;
}

/* ---------- BOTÓN FINALIZAR ---------- */

document.querySelector('.finish').addEventListener('click', () => {
    alert('Cálculo rematado. Revisa o resumo da nómina.');
});

</script>

</body>
</html>
