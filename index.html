<!DOCTYPE html>
<html lang="gl">
<head>
    <meta charset="UTF-8">
    <title>Calculadora Nómina Vicusgraf</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
    body {
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Arial, sans-serif;
        background: #f3f8f4;
        color: #1f3b2c;
    }
    #wizard {
        position: relative;
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
        overflow: hidden;
        height: 100vh;
        background: #ffffff;
        box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    .screen {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        height: calc(100vh - 20px);
        padding: 20px;
        box-sizing: border-box;
        overflow-y: auto;
        background: #ffffff;
        transition: top 0.4s ease;
    }
    .screen.active { top: 0; }
    .screen.up { top: -100%; }

    h2 {
        margin-top: 0;
        font-size: 1.6rem;
        color: #1f3b2c;
    }
    h3 {
        margin-top: 25px;
        font-size: 1.2rem;
        color: #2d5c42;
    }
    label {
        display: block;
        margin-top: 15px;
        font-weight: 600;
    }
    input[type="number"],
    input[type="date"],
    select {
        width: 100%;
        padding: 12px;
        margin-top: 5px;
        border-radius: 10px;
        border: 1px solid #b7d2c0;
        background: #f7fbf8;
        font-size: 1rem;
        box-sizing: border-box;
    }
    input[type="checkbox"],
    input[type="radio"] {
        transform: scale(1.2);
        margin-right: 8px;
    }
    button {
        width: 100%;
        padding: 14px;
        margin-top: 25px;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
    }
    .next { background: #4caf50; color: white; }
    .back { background: #d9e8dd; color: #1f3b2c; }
    .finish { background: #2e7d32; color: white; }

    #resumoDevengos,
    #resumoBases,
    #resumoDeduccions,
    #resumoLiquido {
        background: #f3f8f4;
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
        border: 1px solid #cfe3d6;
    }
    #glosario {
        background: #f3f8f4;
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #cfe3d6;
    }
    p.info {
        font-size: 0.9rem;
        color: #486854;
        margin-top: 5px;
    }
    </style>
</head>

<body>

<div id="wizard">

    <!-- PANTALLA 1 — DATOS XERAIS -->
    <section class="screen active" id="screen-1">
        <h2>Datos xerais da nómina</h2>

        <label>Mes da nómina</label>
        <select id="mes"></select>

        <label>Ano da nómina</label>
        <select id="ano"></select>

        <label>Nivel salarial</label>
        <select id="nivel"></select>

        <label>Data de ingreso na empresa</label>
        <input type="date" id="dataIngreso">

        <label>% IRPF aplicado</label>
        <input type="number" id="irpf" step="0.1">

        <label>
            <input type="checkbox" id="prorrata"> Pagas extra prorrateadas
        </label>

        <button class="next" data-next="2">Continuar</button>
    </section>


    <!-- PANTALLA 2 — INCIDENCIAS -->
    <section class="screen" id="screen-2">
        <h2>Incidencias do mes</h2>

        <h3>Nocturnidade</h3>
        <label><input type="checkbox" id="noiteCompleta"> Mes completo en noite</label>
        <label>Días completos nocturnos</label>
        <input type="number" id="diasNoite">
        <label>Horas nocturnas laborables</label>
        <input type="number" id="horasNoiteLab">
        <label>Horas nocturnas festivas</label>
        <input type="number" id="horasNoiteFest">

        <h3>Horas extra</h3>
        <label>Horas extra laborables</label>
        <input type="number" id="hexLab">
        <label>Horas extra festivas</label>
        <input type="number" id="hexFest">
        <label><input type="checkbox" id="hexNocturnas"> Horas extra nocturnas</label>

        <h3>Incapacidade Temporal</h3>
        <label><input type="checkbox" id="haiIT"> Hai baixa por IT este mes</label>
        <p class="info">Se marcas esta opción, pedirémosche os datos da baixa na seguinte pantalla.</p>

        <button class="back" data-back="1">Volver</button>
        <button class="next" data-next="3">Continuar</button>
    </section>


    <!-- PANTALLA 3 — IT -->
    <section class="screen" id="screen-3">
        <h2>Incapacidade Temporal (IT)</h2>

        <h3>Tipo de baixa</h3>
        <label><input type="radio" name="tipoIT" value="ec"> Enfermidade común</label>
        <p class="info">Baixa por enfermidade non relacionada co traballo.</p>

        <label><input type="radio" name="tipoIT" value="anl"> Accidente non laboral</label>
        <p class="info">Lesión producida fóra do traballo e non recoñecida como profesional.</p>

        <label><input type="radio" name="tipoIT" value="atep"> AT/EP – Accidente de Traballo / Enfermidade Profesional</label>
        <p class="info">Lesión ou enfermidade causada polo traballo ou no traxecto ao traballo (in itinere). Prestación SS: 75% da BRD desde o día seguinte.</p>

        <label><input type="checkbox" id="hospitalizacion"> Hospitalización</label>
        <p class="info">Se estiveches ingresado, o convenio pode mellorar a prestación ata o 100%.</p>

        <h3>Tramo no que te atopas (días de baixa)</h3>
        <p class="info">Os tramos refírense ao número total de días que levas de baixa, non só aos deste mes.</p>
        <select id="tramoIT">
            <option value="">Selecciona un tramo</option>
            <option value="1-3">1–3 días de baixa (0%)</option>
            <option value="4-20">4–20 días de baixa (60%)</option>
            <option value="21+">21+ días de baixa (75%)</option>
            <option value="atep">AT/EP (75%)</option>
        </select>

        <h3>Base de cotización do mes anterior</h3>
        <input type="number" id="baseAnterior" step="0.01">
        <p class="info">Introduce a base de cotización por continxencias comúns da nómina do mes anterior á baixa.</p>
        <p id="brdMostrada">Base reguladora diaria calculada: —</p>

        <h3>Días de baixa neste mes</h3>
        <input type="number" id="diasMesIT">
        <p class="info">Só se usa para calcular o importe deste mes. Non afecta ao tramo.</p>

        <button class="back" data-back="2">Volver</button>
        <button class="next" data-next="4">Continuar</button>
    </section>


    <!-- PANTALLA 4 — RESUMO -->
    <section class="screen" id="screen-4">
        <h2>Resumo da nómina</h2>

        <div id="resumoDevengos"></div>
        <div id="resumoBases"></div>
        <div id="resumoDeduccions"></div>
        <div id="resumoLiquido"></div>

        <button class="back" data-back="3">Volver</button>
        <button class="finish">Finalizar</button>
    </section>


    <!-- PANTALLA 5 — GLOSARIO -->
    <section class="screen" id="screen-5">
        <h2>Glosario de termos</h2>
        <div id="glosario">
            <p><strong>Nivel salarial:</strong> categoría retributiva segundo o convenio.</p>
            <p><strong>Base de cotización:</strong> importe sobre o que se calculan as cotas á Seguridade Social.</p>
            <p><strong>Continxencias comúns:</strong> situacións de enfermidade común ou accidente non laboral.</p>
            <p><strong>AT/EP:</strong> Accidente de Traballo / Enfermidade Profesional.</p>
            <p><strong>Base reguladora diaria (BRD):</strong> base de cotización do mes anterior dividida entre 30.</p>
            <p><strong>Devengos:</strong> todos os importes que suman ao salario bruto.</p>
            <p><strong>Deduccións:</strong> cotas á Seguridade Social, desemprego, formación e IRPF.</p>
            <p><strong>Líquido a percibir:</strong> importe final que se cobra en conta.</p>
        </div>
        <button class="back" data-back="4">Pechar</button>
    </section>

</div>

<script>
/* ---------- TÁBOAS SALARIAIS (2025) ---------- */
/* Podes engadir 2023 e 2024 co mesmo formato se queres afinar máis. */

const tablas = {
    2025: {
        1:  { salarioBase: 26582.31, pagaVeran: 2184.85, pagaNadal: 2184.85, pagaMarzo: 2476.16, lineal: 5196.31, smi: 0.00 },
        2:  { salarioBase: 21129.53, pagaVeran: 1736.67, pagaNadal: 1736.67, pagaMarzo: 1968.23, lineal: 5196.31, smi: 0.00 },
        3:  { salarioBase: 20447.94, pagaVeran: 1680.65, pagaNadal: 1680.65, pagaMarzo: 1904.74, lineal: 5196.31, smi: 0.00 },
        4:  { salarioBase: 19084.73, pagaVeran: 1568.61, pagaNadal: 1568.61, pagaMarzo: 1777.76, lineal: 5196.31, smi: 0.00 },
        5:  { salarioBase: 17721.55, pagaVeran: 1456.57, pagaNadal: 1456.57, pagaMarzo: 1650.77, lineal: 5196.31, smi: 0.00 },
        6:  { salarioBase: 16358.35, pagaVeran: 1344.52, pagaNadal: 1344.52, pagaMarzo: 1523.79, lineal: 5196.31, smi: 0.00 },
        7:  { salarioBase: 15676.78, pagaVeran: 1288.50, pagaNadal: 1288.50, pagaMarzo: 1460.30, lineal: 5196.31, smi: 0.00 },
        8:  { salarioBase: 14995.15, pagaVeran: 1232.48, pagaNadal: 1232.48, pagaMarzo: 1396.81, lineal: 5196.31, smi: 0.00 },
        9:  { salarioBase: 14313.57, pagaVeran: 1176.46, pagaNadal: 1176.46, pagaMarzo: 1333.32, lineal: 5196.31, smi: 0.00 },
        10: { salarioBase: 13631.97, pagaVeran: 1120.44, pagaNadal: 1120.44, pagaMarzo: 1269.83, lineal: 5196.31, smi: 0.00 },
        11: { salarioBase: 12950.37, pagaVeran: 1064.41, pagaNadal: 1064.41, pagaMarzo: 1206.34, lineal: 5196.31, smi: 0.00 },
        12: { salarioBase: 12268.77, pagaVeran: 1008.39, pagaNadal: 1008.39, pagaMarzo: 1142.84, lineal: 5196.31, smi: 0.00 },
        13: { salarioBase: 11587.16, pagaVeran: 952.37, pagaNadal: 952.37, pagaMarzo: 1079.35, lineal: 5196.31, smi: 0.00 },
        14: { salarioBase: 11110.06, pagaVeran: 913.16, pagaNadal: 913.16, pagaMarzo: 1034.91, lineal: 5196.31, smi: 0.00 },
        15: { salarioBase: 10564.77, pagaVeran: 868.34, pagaNadal: 868.34, pagaMarzo: 984.12,  lineal: 5196.31, smi: 0.00 },
        16: { salarioBase: 10019.49, pagaVeran: 823.52, pagaNadal: 823.52, pagaMarzo: 933.32,  lineal: 5196.31, smi: 0.00 },
        17: { salarioBase: 9542.38,  pagaVeran: 784.31, pagaNadal: 784.31, pagaMarzo: 888.88,  lineal: 5196.31, smi: 0.00 },
        18: { salarioBase: 9133.42,  pagaVeran: 750.69, pagaNadal: 750.69, pagaMarzo: 850.78,  lineal: 5196.31, smi: 0.00 },
        19: { salarioBase: 8724.45,  pagaVeran: 717.08, pagaNadal: 717.08, pagaMarzo: 812.69,  lineal: 5196.31, smi: 408.39 }
    }
};

/* Nocturnidade 2025 */
const nocturnaNormal = {
    1:4.53, 2:3.60, 3:3.49, 4:3.25, 5:3.02, 6:2.79, 7:2.67, 8:2.56,
    9:2.44, 10:2.32, 11:2.21, 12:2.09, 13:1.98, 14:1.89, 15:1.80,
    16:1.71, 17:1.63, 18:1.56, 19:1.49
};
const nocturnaFestiva = {
    1:5.29, 2:4.20, 3:4.07, 4:3.80, 5:3.52, 6:3.25, 7:3.12, 8:2.98,
    9:2.85, 10:2.71, 11:2.58, 12:2.44, 13:2.30, 14:2.21, 15:2.10,
    16:1.99, 17:1.90, 18:1.82, 19:1.73
};

/* ---------- FUNCIÓNS AUXILIARES ---------- */

function anoReferencia(ano) {
    if (ano >= 2026) return 2025;
    return ano;
}

function horasAnuais(ano) {
    return ano >= 2025 ? 1760 : 1768;
}

/* ---------- INICIALIZACIÓN ---------- */

const screens = document.querySelectorAll('.screen');

function showScreen(id) {
    screens.forEach(s => s.classList.remove('active','up'));
    const target = document.getElementById('screen-' + id);
    target.classList.add('active');
}

(function initMesAnoNivel() {
    const mesSelect = document.getElementById('mes');
    const anoSelect = document.getElementById('ano');
    const nivelSelect = document.getElementById('nivel');

    const meses = [
        'Xaneiro','Febreiro','Marzo','Abril','Maio','Xuño',
        'Xullo','Agosto','Setembro','Outubro','Novembro','Decembro'
    ];
    meses.forEach((m, i) => {
        const opt = document.createElement('option');
        opt.value = i + 1;
        opt.textContent = m;
        mesSelect.appendChild(opt);
    });

    const anoActual = new Date().getFullYear();
    for (let a = anoActual - 2; a <= anoActual + 1; a++) {
        const opt = document.createElement('option');
        opt.value = a;
        opt.textContent = a;
        anoSelect.appendChild(opt);
    }

    for (let n = 1; n <= 19; n++) {
        const opt = document.createElement('option');
        opt.value = n;
        opt.textContent = 'Nivel ' + n;
        nivelSelect.appendChild(opt);
    }
})();

/* ---------- NAVEGACIÓN ---------- */

document.querySelectorAll('.next').forEach(btn => {
    btn.addEventListener('click', () => {
        const nextId = btn.getAttribute('data-next');

        if (nextId === '3') {
            const haiIT = document.getElementById('haiIT').checked;
            if (!haiIT) {
                showScreen('4');
                calcularResumo();
                return;
            }
        }

        if (nextId === '4') {
            calcularResumo();
        }

        showScreen(nextId);
    });
});

document.querySelectorAll('.back').forEach(btn => {
    btn.addEventListener('click', () => {
        const backId = btn.getAttribute('data-back');
        showScreen(backId);
    });
});

/* ---------- BRD ---------- */

const baseAnteriorInput = document.getElementById('baseAnterior');
const brdMostrada = document.getElementById('brdMostrada');
let brdCalculada = 0;

baseAnteriorInput.addEventListener('input', () => {
    const base = parseFloat(baseAnteriorInput.value || '0');
    if (base > 0) {
        brdCalculada = base / 30;
        brdMostrada.textContent = 'Base reguladora diaria calculada: ' + brdCalculada.toFixed(4) + ' €/día';
    } else {
        brdCalculada = 0;
        brdMostrada.textContent = 'Base reguladora diaria calculada: —';
    }
});

/* ---------- VALOR HORA E HORAS EXTRA ---------- */

function obterDatosNivelAno() {
    const ano = parseInt(document.getElementById('ano').value || '0');
    const nivel = parseInt(document.getElementById('nivel').value || '0');
    if (!ano || !nivel) return null;

    const ref = anoReferencia(ano);
    const t = tablas[ref] && tablas[ref][nivel];
    if (!t) return null;

    const salarioAnualTotal =
        t.salarioBase +
        t.pagaVeran +
        t.pagaNadal +
        t.pagaMarzo +
        t.lineal +
        t.smi;

    const horasAno = horasAnuais(ref);
    const valorHora = salarioAnualTotal / horasAno;

    return { ano, ref, nivel, t, salarioAnualTotal, horasAno, valorHora };
}

/* ---------- IT ---------- */

function calcularIT() {
    const haiIT = document.getElementById('haiIT').checked;
    if (!haiIT) {
        return {
            devengoIT: 0,
            prestacionSS: 0,
            complementoEmpresa: 0
        };
    }

    const tipoIT = document.querySelector('input[name="tipoIT"]:checked');
    const tramo = document.getElementById('tramoIT').value;
    const diasMesIT = parseFloat(document.getElementById('diasMesIT').value || '0');

    if (!tipoIT || !tramo || brdCalculada === 0 || diasMesIT === 0) {
        return {
            devengoIT: 0,
            prestacionSS: 0,
            complementoEmpresa: 0
        };
    }

    let porcentaxeSS = 0;
    let porcentaxeFinal = 0;

    if (tramo === '1-3') {
        porcentaxeSS = 0;
        porcentaxeFinal = 0;
    } else if (tramo === '4-20') {
        porcentaxeSS = 0.60;
        porcentaxeFinal = 0.60;
    } else if (tramo === '21+') {
        porcentaxeSS = 0.75;
        porcentaxeFinal = 0.75;
    } else if (tramo === 'atep') {
        porcentaxeSS = 0.75;
        porcentaxeFinal = 0.75;
        const hosp = document.getElementById('hospitalizacion').checked;
        if (hosp) porcentaxeFinal = 1.0;
    }

    const prestacionSS = brdCalculada * diasMesIT * porcentaxeSS;
    const devengoFinal = brdCalculada * diasMesIT * porcentaxeFinal;
    const complementoEmpresa = devengoFinal - prestacionSS;

    return {
        devengoIT: devengoFinal,
        prestacionSS: prestacionSS,
        complementoEmpresa: complementoEmpresa > 0 ? complementoEmpresa : 0
    };
}

/* ---------- NOCTURNIDADE ---------- */

function calcularNocturnidade(dados) {
    if (!dados) return 0;

    const nivel = dados.nivel;
    const prezoNoiteNormal = nocturnaNormal[nivel] || 0;
    const prezoNoiteFestiva = nocturnaFestiva[nivel] || 0;

    const noiteCompleta = document.getElementById('noiteCompleta').checked;
    const diasNoite = parseFloat(document.getElementById('diasNoite').value || '0');
    const horasNoiteLab = parseFloat(document.getElementById('horasNoiteLab').value || '0');
    const horasNoiteFest = parseFloat(document.getElementById('horasNoiteFest').value || '0');

    let horasNocturnasLab = horasNoiteLab;
    let horasNocturnasFest = horasNoiteFest;

    if (noiteCompleta) {
        const horasDia = 8;
        horasNocturnasLab += diasNoite * horasDia;
    }

    const importeNoctLab = horasNocturnasLab * prezoNoiteNormal;
    const importeNoctFest = horasNocturnasFest * prezoNoiteFestiva;

    return importeNoctLab + importeNoctFest;
}

/* ---------- HORAS EXTRA ---------- */

function calcularHorasExtra(dados) {
    if (!dados) return { hexNormais: 0, hexFestivas: 0, total: 0 };

    const valorHora = dados.valorHora;
    const hexLab = parseFloat(document.getElementById('hexLab').value || '0');
    const hexFest = parseFloat(document.getElementById('hexFest').value || '0');

    const importeHexNormais = hexLab * valorHora;
    const importeHexFestivas = hexFest * valorHora * 1.5;

    return {
        hexNormais: importeHexNormais,
        hexFestivas: importeHexFestivas,
        total: importeHexNormais + importeHexFestivas
    };
}

/* ---------- SALARIO BASE + PRORRATA + LINEAL ---------- */

function calcularSalarioBase(dados) {
    if (!dados) return { salarioMensual: 0, prorrata: 0, linealMensual: 0, smiMensual: 0, total: 0 };

    const t = dados.t;
    const prorrata = document.getElementById('prorrata').checked;

    const salarioMensual = t.salarioBase / 12;
    const linealMensual = t.lineal / 12;
    const smiMensual = t.smi / 12;

    let prorrataMensual = 0;
    if (prorrata) {
        prorrataMensual = (t.pagaVeran + t.pagaNadal + t.pagaMarzo) / 12;
    }

    const total = salarioMensual + linealMensual + smiMensual + prorrataMensual;

    return {
        salarioMensual,
        prorrata: prorrataMensual,
        linealMensual,
        smiMensual,
        total
    };
}

/* ---------- RESUMO ---------- */

function calcularResumo() {
    const resumoDevengos = document.getElementById('resumoDevengos');
    const resumoBases = document.getElementById('resumoBases');
    const resumoDeduccions = document.getElementById('resumoDeduccions');
    const resumoLiquido = document.getElementById('resumoLiquido');

    const dados = obterDatosNivelAno();
    if (!dados) {
        resumoDevengos.innerHTML = '<p>Faltan datos de ano ou nivel.</p>';
        resumoBases.innerHTML = '';
        resumoDeduccions.innerHTML = '';
        resumoLiquido.innerHTML = '';
        return;
    }

    const it = calcularIT();
    const noct = calcularNocturnidade(dados);
    const hex = calcularHorasExtra(dados);
    const sal = calcularSalarioBase(dados);

    const devengosTotais = sal.total + noct + hex.total + it.devengoIT;

    const baseCC = devengosTotais;
    const baseATEP = devengosTotais;
    const baseIRPF = devengosTotais;

    const tipoIRPF = parseFloat(document.getElementById('irpf').value || '0') / 100;
    const ccTraballador = baseCC * 0.047;
    const desemprego = baseATEP * 0.0155;
    const formacion = baseATEP * 0.001;
    const irpfImporte = baseIRPF * tipoIRPF;

    const totalDeduccions = ccTraballador + desemprego + formacion + irpfImporte;
    const liquido = devengosTotais - totalDeduccions;

    resumoDevengos.innerHTML = `
        <h3>Devengos</h3>
        <p>Salario mensual: ${sal.salarioMensual.toFixed(2)} €</p>
        <p>Complemento lineal mensual: ${sal.linealMensual.toFixed(2)} €</p>
        <p>Prorrata pagas extra: ${sal.prorrata.toFixed(2)} €</p>
        <p>Complemento SMI mensual: ${sal.smiMensual.toFixed(2)} €</p>
        <p>Nocturnidade: ${noct.toFixed(2)} €</p>
        <p>Horas extra laborables: ${hex.hexNormais.toFixed(2)} €</p>
        <p>Horas extra festivas: ${hex.hexFestivas.toFixed(2)} €</p>
        <p>Prestación IT total: ${it.devengoIT.toFixed(2)} € (SS: ${it.prestacionSS.toFixed(2)} €, complemento: ${it.complementoEmpresa.toFixed(2)} €)</p>
        <p><strong>Total devengos: ${devengosTotais.toFixed(2)} €</strong></p>
        <hr>
        <p>Valor hora ordinaria: ${dados.valorHora.toFixed(4)} €/h</p>
        <p>Valor hora extra normal: ${dados.valorHora.toFixed(4)} €/h</p>
        <p>Valor hora extra festiva: ${(dados.valorHora * 1.5).toFixed(4)} €/h</p>
    `;

    resumoBases.innerHTML = `
        <h3>Bases de cotización</h3>
        <p>Base CC: ${baseCC.toFixed(2)} €</p>
        <p>Base AT/EP: ${baseATEP.toFixed(2)} €</p>
        <p>Base IRPF: ${baseIRPF.toFixed(2)} €</p>
    `;

    resumoDeduccions.innerHTML = `
        <h3>Deduccións</h3>
        <p>Continxencias comúns (4,70%): ${ccTraballador.toFixed(2)} €</p>
        <p>Desemprego (1,55%): ${desemprego.toFixed(2)} €</p>
        <p>Formación profesional (0,10%): ${formacion.toFixed(2)} €</p>
        <p>IRPF (${(tipoIRPF*100).toFixed(1)}%): ${irpfImporte.toFixed(2)} €</p>
        <p><strong>Total deduccións: ${totalDeduccions.toFixed(2)} €</strong></p>
    `;

    resumoLiquido.innerHTML = `
        <h3>Líquido a percibir</h3>
        <p><strong>${liquido.toFixed(2)} €</strong></p>
    `;
}

/* ---------- FINALIZAR ---------- */

document.querySelector('.finish').addEventListener('click', () => {
    alert('Cálculo rematado. Revisa o resumo da nómina.');
});
</script>

</body>
</html>
